#ifndef _WL_CONFIG_H_
#define _WL_CONFIG_H_

#include <string>
#include <vector>

#include "Defs.hpp"
#include "model/Function.hpp"

using std::string;

namespace cmpex {

  namespace model {
    class Function;
  }

  namespace workload {


    //======================================================================
    // Config is a storage for workload parameters.
    //======================================================================

    class WlConfig
    {

    public:

      // Data structure for a thread.
      struct Thread {
        int thread_id;
	int thread_xyloc[2]; //0(1) is x(y) coordinate in cmp
	int thread_instructions;
	int thread_progress;
      };

      typedef std::vector<Thread*> ThreadArray;

      // Data structure for a task.
      struct Task {
        ~Task() { delete missRatioOfMemSize; }
	int task_id;
	int task_dop; // degree of parallelism, i.e. number of threads
	int task_cluster_id; 
	std::vector<int[2]> task_cluster_xyloc; // coordinates of all threads forming a cluster
        model::Function * missRatioOfMemSize;
        double ipc;
        double mpi;
	int task_instructions; // total instructions to be executed
	int task_progress; // instructions executed till NOW
	int task_deadline; // deadline time in ms
	int task_elapsed; // task runtime in ms
	int task_slack; // remaining time from NOW till deadline in ms
	ThreadArray task_threads;
      };

      typedef std::vector<Task*> TaskArray;

      typedef TaskArray::const_iterator TaskCIter;

      TaskArray tasks;

      // ---------------------------- Methods ------------------------------

    public:

      WlConfig ( void );

      ~WlConfig ();

      inline void AddTask ( Task * t );

      inline void AddThread ( Thread * t, int i );

      inline int TaskCnt () const;

      // Create Tasks
      int CreateTasks ( int ntasks );

      // DEBUG: Print Tasks
      int PrintTasks ( int ntasks );

      void Cleanup();

    private:

    };

    //----------------------------------------------------------------------
    // Inline functions
    //----------------------------------------------------------------------
    
    void WlConfig::AddTask ( WlConfig::Task * t ) {
      tasks.push_back(t);
    }

    void WlConfig::AddThread ( WlConfig::Thread * t, int i ) {
      tasks[i]->task_threads.push_back(t);
    }

    int WlConfig::TaskCnt () const {
      return tasks.size();
    }

  } // namespace workload

} // namespace cmpex

#endif // _WL_CONFIG_H_
